A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     1


MACRO ASSEMBLER A51 V8.2.7.0
OBJECT MODULE PLACED IN .\Objects\..\..\C8051F020StWork_v1.0.0-main\Tasks\runningTask.obj
ASSEMBLER INVOKED BY: C:\Keil_v5\C51\BIN\A51.EXE C:\C8051F020StWork_v1.0.0-main\Tasks\runningTask.asm NOMOD51 SET(SMALL)
                       DEBUG PRINT(.\Listings\..\..\C8051F020StWork_v1.0.0-main\Tasks\runningTask.lst) OBJECT(.\Objects\
                      ..\..\C8051F020StWork_v1.0.0-main\Tasks\runningTask.obj) EP

LOC  OBJ            LINE     SOURCE

                       1     ; Running task: handles RUN state logic moved from main.ASM
                       2     Running SEGMENT CODE
----                   3     rseg Running
                       4     
                       5     ;$include (../user/config.inc)
                +1     6     ; 索引从 0 开始，供 main.ASM 中通过偏移访问 (MOVC @A+DPTR)
                +1     7     ; 00 - '0'  - 0C0h
                +1     8     ; 01 - '1'  - 0F9h
                +1     9     ; 02 - '2'  - 0A4h
                +1    10     ; 03 - '3'  - 0B0h
                +1    11     ; 04 - '4'  - 099h
                +1    12     ; 05 - '5'  - 092h
                +1    13     ; 06 - '6'  - 082h
                +1    14     ; 07 - '7'  - 0F8h
                +1    15     ; 08 - '8'  - 080h
                +1    16     ; 09 - '9'  - 090h
                +1    17     ; 10 - 'A'  - 088h
                +1    18     ; 11 - 'b'  - 083h
                +1    19     ; 12 - 'C'  - 0C6h
                +1    20     ; 13 - 'd'  - 0A1h
                +1    21     ; 14 - 'E'  - 086h
                +1    22     ; 15 - 'F'  - 08Eh
                +1    23     ; 16 - '_'  - 0F7h
                +1    24     ; 17 - 'P.' - 00Ch
                +1    25     ; 18 - 'r'  - 0AFh
                +1    26     ; 19 - 'L'  - 047h
                +1    27     ; 20 - '0.' - 040h
                +1    28     ; 21 - '1.' - 079h
                +1    29     ; 22 - '2.' - 024h
                +1    30     ; 23 - '3.' - 030h
                +1    31     ; 24 - '4.' - 019h
                +1    32     ; 25 - '5.' - 012h
                +1    33     ; 26 - '6.' - 002h
                +1    34     ; 27 - '7.' - 078h
                +1    35     ; 28 - '8.' - 000h
                +1    36     ; 29 - '9.' - 010h
                +1    37     ; 30 - 'n'  - 0ABh
                +1    38     ; 31 - 'o'  - 0A3h
                +1    39     ; 32 - 'o.' - 023h
                +1    40     ; 33 - OFF  - 0FFh    ; 熄灭 (全部段关闭)
                +1    41     ; 34 - 'C.' - 046h    ; 自定义 C 带小数点
                +1    42     ; 35 - 'U'  - 0C1h
                +1    43     ; 36 - '-'  - 0BFh
                +1    44     ; 37 - ' '  - 0FFh
                +1    45     
0000            +1    46     SEG_TABLE:
0000 C0F9A4B0   +1    47         DB 0C0h,0F9h,0A4h,0B0h,099h,092h,082h,0F8h,080h,090h,088h,083h,0C6h,0A1h,086h,08Eh,0F7h
                             ,00Ch,0AFh,047h
0004 999282F8                
0008 80908883                
000C C6A1868E                
0010 F70CAF47                
0014 40792430   +1    48         DB 040h,079h,024h,030h,019h,012h,002h,078h,000h,010h
0018 19120278                
001C 0010                    
001E ABA323FF   +1    49         DB 0ABh,0A3h,023h,0FFh,046h,0C1h,0BFh,0FFh
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     2

0022 46C1BFFF                
                +1    50     
0026            +1    51     BITMASK_TABLE:
0026 80402010   +1    52         DB 080h,040h,020h,010h,008h,004h
002A 0804                    
                +1    53     
002C            +1    54     PASSWORD_TABLE:
002C 01020304   +1    55         DB 01h,02h,03h,04h,05h
0030 05                      
                +1    56     
                +1    57     ; RUN_ST, OPT_ST, PASS_ST, OPT1_ST, OPT2_ST, OPT3_ST
  0000          +1    58     RUN_ST  EQU     00h
  0001          +1    59     OPT_ST  EQU     01h
  0002          +1    60     PASS_ST EQU     02h
  0011          +1    61     OPT1_ST EQU     11h
  0012          +1    62     OPT2_ST EQU     12h
  0013          +1    63     OPT3_ST EQU     13h
                +1    64     
                +1    65     ; Elevator states
  0020          +1    66     ELEV_ST EQU 20h
  0021          +1    67     ELEV_RUN EQU 21h
  0022          +1    68     ELEV_ARRIVED EQU 22h
  0023          +1    69     ELEV_CLOSE EQU 23h
                +1    70     
                +1    71     ; Elevator variables (RAM)
  0056          +1    72     CUR_FLr      EQU 056h
  0057          +1    73     ELEV_TIMER   EQU 057h
  0058          +1    74     ELEV_TARGET  EQU 058h
  0059          +1    75     ONE_SEC_CNT  EQU 059h
  005A          +1    76     BLINK_TIMER  EQU 05Ah
  005B          +1    77     BLINK_TOGGLE EQU 05Bh
                +1    78     
                +1    79     ; Queue variables (BITMAP based - 11 floors: -2 to 8)
                +1    80     ; Bit 0 = Floor -2, Bit 1 = Floor -1, Bit 2 = Floor 1, ... Bit 10 = Floor 8
                +1    81     ; Use 2 bytes: Low byte (bits 0-7), High byte (bits 8-10)
  005C          +1    82     INT_REQ_LO     EQU 05Ch  ; Internal request bitmap low (floors -2 to 5)
  005D          +1    83     INT_REQ_HI     EQU 05Dh  ; Internal request bitmap high (floors 6 to 8)
  005E          +1    84     EXT_UP_LO      EQU 05Eh  ; External UP request bitmap low
  005F          +1    85     EXT_UP_HI      EQU 05Fh  ; External UP request bitmap high
  0062          +1    86     EXT_DN_LO      EQU 062h  ; External DOWN request bitmap low
  0063          +1    87     EXT_DN_HI      EQU 063h  ; External DOWN request bitmap high
  0064          +1    88     ELEV_DIR       EQU 064h  ; Current direction: 0=停止, 1=上, 2=下
                +1    89     
                +1    90     ; Input Mode variables
  0065          +1    91     INPUT_MODE     EQU 065h ; 0=Inside, 1=Outside
  0066          +1    92     OUT_SEL_VAL    EQU 066h ; Temp storage for outside floor selection
  0067          +1    93     DEBUG_ON       EQU 067h ; Global debug flag: 0=normal, 1=jump to debug task
                +1    94     
                +1    95     ; Floor to Bit Index mapping:
                +1    96     ; Floor -2 -> Index 0
                +1    97     ; Floor -1 -> Index 1
                +1    98     ; Floor  1 -> Index 2
                +1    99     ; Floor  2 -> Index 3
                +1   100     ; ...
                +1   101     ; Floor  8 -> Index 10
                +1   102     ; Formula: Index = Floor + 2 (if Floor >= 1, Index = Floor + 1)
                     103     
                     104     ;$include (../driver/LCD1602.inc)
                +1   105     EXTRN CODE(LCD_INIT)
                +1   106     EXTRN CODE(LCD_WR_CMD)
                +1   107     EXTRN CODE(LCD_WR_DAT)
                +1   108     EXTRN CODE(LCD_CLEAR)
                +1   109     EXTRN CODE(LCD_SHOW_STR)
                     110     
                     111     
                     112     EXTRN CODE(LED6_ApplyTable)
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     3

                     113     
                     114     PUBLIC RunningTask_Init
                     115     PUBLIC RunningTask_Handler
                     116     
                     117     ; LCD Strings
0031                 118     LCD_MSG_INSIDE:
0031 496E7369        119         DB 'I','n','s','i','d','e',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ', 00h
0035 64652020                
0039 20202020                
003D 20202020                
0041 00                      
0042                 120         LCD_MSG_WELCOME:
0042 57656C63        121         DB 'W','e','l','c','o','m','e',' ',' ',' ',' ',' ',' ',' ',' ',' ', 00h
0046 6F6D6520                
004A 20202020                
004E 20202020                
0052 00                      
0053                 122     LCD_STR_OUT_PREFIX:
0053 4F75743A        123         DB 'O','u','t',':',' ', 00h
0057 2000                    
0059                 124     LCD_STR_UP:
0059 55702020        125         DB 'U','p',' ',' ', 00h
005D 00                      
005E                 126     LCD_STR_DOWN:
005E 446F776E        127         DB 'D','o','w','n', 00h
0062 00                      
0063                 128     LCD_STR_EMPTY:
0063 20202020        129         DB ' ',' ',' ',' ', 00h
0067 00                      
                     130     
0068                 131     LCD_MSG_OPEN:
0068 2020206F        132         DB ' ',' ',' ','o','p','e','n',' ','d','o','o','r',' ',' ',' ',' ', 00h
006C 70656E20                
0070 646F6F72                
0074 20202020                
0078 00                      
0079                 133     LCD_MSG_CLOSE:
0079 20202063        134         DB ' ',' ',' ','c','l','o','s','e',' ','d','o','o','r',' ',' ',' ', 00h
007D 6C6F7365                
0081 20646F6F                
0085 72202020                
0089 00                      
008A                 135     LCD_MSG_RUN:
008A 20202052        136         DB ' ',' ',' ','R','u','n','n','i','n','g','.','.','.',' ',' ',' ', 00h
008E 756E6E69                
0092 6E672E2E                
0096 2E202020                
009A 00                      
009B                 137     LCD_MSG_FL:
009B 464C3A20        138         DB 'F','L',':',' ', 00h
009F 00                      
                     139     
                     140     ; Initialize running task: set up elevator defaults
00A0                 141     RunningTask_Init:
00A0 755601          142         MOV CUR_FLr, #01h      ; 默认 1楼
00A3 755900          143         MOV ONE_SEC_CNT, #00h
00A6 755700          144         MOV ELEV_TIMER, #00h
00A9 755801          145         MOV ELEV_TARGET, #01h
                     146         
                     147         ; Init Request Bitmaps (all clear)
00AC 755C00          148         MOV INT_REQ_LO, #00h
00AF 755D00          149         MOV INT_REQ_HI, #00h
00B2 755E00          150         MOV EXT_UP_LO, #00h
00B5 755F00          151         MOV EXT_UP_HI, #00h
00B8 756200          152         MOV EXT_DN_LO, #00h
00BB 756300          153         MOV EXT_DN_HI, #00h
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     4

00BE 756400          154         MOV ELEV_DIR, #00h     ; Stopped
                     155         
                     156         ; Init Input Mode
00C1 756500          157         MOV INPUT_MODE, #00h   ; Default Inside
00C4 756601          158         MOV OUT_SEL_VAL, #01h  ; Default selection
                     159         
                     160         ; Init LCD
00C7 120000   F      161         LCALL LCD_INIT
00CA 120000   F      162         LCALL LCD_CLEAR
00CD 900000   F      163         MOV DPTR, #LCD_MSG_WELCOME
00D0 120000   F      164         LCALL LCD_SHOW_STR
00D3 22              165         RET
                     166     
                     167     ; Handler implements the RUN_HANDLER logic from main.ASM
00D4                 168     RunningTask_Handler:
                     169         ; Dispatcher: RUN or ELEV states
00D4 E570            170         MOV A, 070h
00D6 B40039          171         CJNE A, #RUN_ST, CHECK_ELEV_RUN
                     172         ; RUN state
00D9 E571            173         MOV A, 071h
00DB B57019          174         CJNE A, 070h, RT_INIT
                     175     
00DE E561            176         MOV A, 061h
00E0 B40002          177         CJNE A, #00h, RT_HANDLE_KEY
00E3 8018            178         SJMP RT_MODE
                     179     
00E5                 180     RT_HANDLE_KEY:
00E5 E560            181         MOV A, 060h
00E7 B48A08          182         CJNE A, #08Ah, RT_HANDLE_OTHER
00EA 757002          183         MOV 070h, #PASS_ST
00ED 756100          184         MOV 061h, #00h
00F0 800B            185         SJMP RT_MODE
                     186     
00F2                 187     RT_HANDLE_OTHER:
00F2 756100          188         MOV 061h, #00h
00F5 8006            189         SJMP RT_MODE
                     190     
00F7                 191     RT_INIT:
00F7 E570            192         MOV A, 070h
00F9 F571            193         MOV 071h, A
00FB 8000            194         SJMP RT_MODE
                     195     
00FD                 196     RT_MODE:
                     197         ; 检查配置是否完成 (050h!=10h 表示 OPT1 已设置)
00FD E550            198         MOV A, 050h
00FF B41009          199         CJNE A, #010h, RT_CONFIG_DONE
                     200         ; 未完成配置，显示空白等待
0102 7401            201         MOV A, #01h
0104 120000   F      202         LCALL LED6_ApplyTable
0107 753904          203         MOV 039h, #04h
010A 22              204         RET
010B                 205     RT_CONFIG_DONE:
                     206         ; 配置完成，切换到电梯待机状态
010B 757020          207         MOV 070h, #ELEV_ST
010E 7571FF          208         MOV 071h, #0FFh        ; 强制刷新
0111 22              209         RET
                     210     
0112                 211     CHECK_ELEV_RUN:
0112 B42004          212         CJNE A, #ELEV_ST, CHECK_ELEV_RUN2
0115 120000   F      213         LCALL ELEV_HANDLER
0118 22              214         RET
0119                 215     CHECK_ELEV_RUN2:
0119 B42104          216         CJNE A, #ELEV_RUN, CHECK_ELEV_ARR
011C 120000   F      217         LCALL ELEV_RUN_HANDLER
011F 22              218         RET
0120                 219     CHECK_ELEV_ARR:
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     5

0120 B42204          220         CJNE A, #ELEV_ARRIVED, CHECK_ELEV_CLOSE
0123 120000   F      221         LCALL ELEV_ARRIVED_HANDLER
0126 22              222         RET
0127                 223     CHECK_ELEV_CLOSE:
0127 B42304          224         CJNE A, #ELEV_CLOSE, RT_RETURN
012A 120000   F      225         LCALL ELEV_CLOSE_HANDLER
012D 22              226         RET
012E                 227     RT_RETURN:
012E 22              228         RET
                     229     
                     230     ; --------------------
                     231     ; Elevator handlers (ported from teammate code)
                     232     ; Uses variables: CUR_FLr (056h), ELEV_TIMER (057h), ELEV_TARGET (058h), ONE_SEC_CNT (059h)
                     233     ; --------------------
                     234     
012F                 235     ELEV_HANDLER:
012F E571            236         MOV A, 071h
0131 B57054          237         CJNE A, 070h, ELEV_INIT
                     238         
                     239         ; 1. Check for new key input and set bitmap
0134 120000   F      240         LCALL CHECK_AND_SET_REQUEST
                     241     
                     242         ; --- Added: Idle Open Logic ---
                     243         ; Check Internal Open Key ('C')
0137 E561            244         MOV A, 061h
0139 6009            245         JZ EH_CHECK_CUR_FL
013B E560            246         MOV A, 060h
013D 540F            247         ANL A, #0Fh
013F B40C02          248         CJNE A, #0Ch, EH_CHECK_CUR_FL
                     249         ; 'C' pressed -> Open
0142 800C            250         SJMP EH_OPEN_NOW
                     251     
0144                 252     EH_CHECK_CUR_FL:
                     253         ; Check request at current floor (Int/Ext)
0144 AE56            254         MOV R6, CUR_FLr
0146 120000   F      255         LCALL CHECK_FLOOR_REQUEST
0149 5012            256         JNC EH_SCAN
                     257         ; Request at current floor -> Open
014B 120000   F      258         LCALL CLEAR_FLOOR_REQUEST
014E 8000            259         SJMP EH_OPEN_NOW
                     260         ; ------------------------------
                     261     
0150                 262     EH_OPEN_NOW:
0150 757022          263         MOV 070h, #ELEV_ARRIVED
0153 755705          264         MOV ELEV_TIMER, #05h
0156 755900          265         MOV ONE_SEC_CNT, #00h
0159 7571FF          266         MOV 071h, #0FFh
015C 22              267         RET
                     268     
015D                 269     EH_SCAN:
                     270         ; 2. Find next target using SCAN algorithm
015D 120000   F      271         LCALL SCAN_FIND_NEXT_TARGET
0160 500B            272         JNC ELEV_CHECK_PARK    ; No request, check parking logic
                     273         
                     274         ; R6 has target floor
0162 EE              275         MOV A, R6
                     276         
                     277         ; Check if target == current
0163 B55605          278         CJNE A, CUR_FLr, ELEV_START_MOVE
                     279         
                     280         ; Target == Current -> Clear request and Open Door
0166 120000   F      281         LCALL CLEAR_FLOOR_REQUEST  ; Clear request for R6
0169 80E5            282         SJMP EH_OPEN_NOW
                     283     
016B                 284     ELEV_START_MOVE:
                     285         ; Target != Current -> Start Moving
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     6

016B 8026            286         SJMP ELEV_DIFF
                     287     
016D                 288     ELEV_CHECK_PARK:
                     289         ; No requests: Decide Parking Floor (1 or 8) based on proximity
                     290         ; Index 2 (Flr 1) vs Index 9 (Flr 8). Split at Floor 4/5.
016D AE56            291         MOV R6, CUR_FLr
016F 120000   F      292         LCALL FLOOR_TO_INDEX  ; R4 = Current Index
0172 EC              293         MOV A, R4
0173 B40600          294         CJNE A, #06h, ECP_TEST
0176                 295     ECP_TEST:
0176 5004            296         JNC ECP_GO_8          ; If A >= 6 (Floor 5+), Go Floor 8
                     297         
0178 7E01            298         MOV R6, #01h          ; Else Go Floor 1
017A 8002            299         SJMP ECP_EXEC
                     300         
017C                 301     ECP_GO_8:
017C 7E08            302         MOV R6, #08h
                     303     
017E                 304     ECP_EXEC:
017E EE              305         MOV A, R6
017F B55604          306         CJNE A, CUR_FLr, ECP_MOVE
                     307         ; Already at parking floor -> Idle
0182 756400          308         MOV ELEV_DIR, #00h
0185 22              309         RET
0186                 310     ECP_MOVE:
                     311         ; Not at parking floor -> Move to target (R6)
0186 800B            312         SJMP ELEV_DIFF
                     313     
0188                 314     ELEV_INIT:
0188 E570            315         MOV A, 070h
018A F571            316         MOV 071h, A
018C 120000   F      317         LCALL LCD_CLEAR
018F 120000   F      318         LCALL SHOW_OPEN_FLOOR
0192 22              319         RET
                     320     
0193                 321     ELEV_DIFF:
0193 8E58            322         MOV ELEV_TARGET, R6
                     323         
                     324         ; Determine direction using Index comparison (avoids signed number issues)
                     325         ; Convert Target to Index
0195 C006            326         PUSH 06h              ; Save R6
0197 120000   F      327         LCALL FLOOR_TO_INDEX
019A EC              328         MOV A, R4
019B FB              329         MOV R3, A             ; R3 = Target Index
                     330         
                     331         ; Convert Current to Index
019C AE56            332         MOV R6, CUR_FLr
019E 120000   F      333         LCALL FLOOR_TO_INDEX  ; R4 = Current Index
01A1 D006            334         POP 06h               ; Restore R6 (Target Floor)
                     335         
                     336         ; Compare: if Target Index > Current Index, go up
01A3 EB              337         MOV A, R3
01A4 C3              338         CLR C
01A5 9C              339         SUBB A, R4            ; A = Target Index - Current Index
01A6 400B            340         JC E_GO_DOWN
01A8 6009            341         JZ E_GO_DOWN          ; Should not happen, but safety
                     342         ; Go Up
01AA 756401          343         MOV ELEV_DIR, #01h
01AD 7D23            344         MOV R5, #35           ; 'U'
01AF F557            345         MOV ELEV_TIMER, A     ; Travel time = index difference
01B1 800A            346         SJMP E_START
01B3                 347     E_GO_DOWN:
01B3 756402          348         MOV ELEV_DIR, #02h
01B6 7D0D            349         MOV R5, #13           ; 'd'
                     350         ; Calculate travel time = Current Index - Target Index
01B8 EC              351         MOV A, R4
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     7

01B9 C3              352         CLR C
01BA 9B              353         SUBB A, R3
01BB F557            354         MOV ELEV_TIMER, A
                     355         
01BD                 356     E_START:
01BD 757021          357         MOV 070h, #ELEV_RUN
01C0 756100          358         MOV 061h, #00h
                     359         
                     360         ; LCD Update
01C3 120000   F      361         LCALL LCD_CLEAR
01C6 900000   F      362         MOV DPTR, #LCD_MSG_RUN
01C9 120000   F      363         LCALL LCD_SHOW_STR
                     364         
01CC 8D28            365         MOV 028h, R5           ; Dir
01CE 752925          366         MOV 029h, #37          ; Space
                     367         
01D1 120000   F      368         LCALL UPDATE_CUR_DISPLAY
01D4 120000   F      369         LCALL UPDATE_TGT_DISPLAY
                     370         
01D7 22              371         RET
                     372     
01D8                 373     ELEV_RUN_HANDLER:
                     374         ; Running display handled by buffer written in E_START
01D8 E571            375         MOV A, 071h
01DA B57020          376         CJNE A, 070h, ER_INIT
                     377         
                     378         ; Update Display with CUR_FLr (Dynamic Update)
01DD 120000   F      379         LCALL UPDATE_CUR_DISPLAY
                     380     
                     381         ; Check if we should stop at current floor (途中停靠)
01E0 AE56            382         MOV R6, CUR_FLr
01E2 120000   F      383         LCALL CHECK_FLOOR_REQUEST
01E5 5012            384         JNC ER_CHK_INT_KEY     ; No request at current floor
                     385         
                     386         ; There's a request at current floor!
                     387         ; Clear the request
01E7 AE56            388         MOV R6, CUR_FLr
01E9 120000   F      389         LCALL CLEAR_FLOOR_REQUEST
                     390         
                     391         ; Transition to Arrived
01EC 757022          392         MOV 070h, #ELEV_ARRIVED
01EF 755705          393         MOV ELEV_TIMER, #05h
01F2 755900          394         MOV ONE_SEC_CNT, #00h
01F5 7571FF          395         MOV 071h, #0FFh
01F8 22              396         RET
                     397     
01F9                 398     ER_CHK_INT_KEY:
                     399         ; Listen for new keys
01F9 120000   F      400         LCALL CHECK_AND_SET_REQUEST
01FC 22              401         RET
                     402     
01FD                 403     ER_INIT:
01FD E570            404         MOV A, 070h
01FF F571            405         MOV 071h, A
0201 22              406         RET
                     407     
0202                 408     ELEV_ARRIVED_HANDLER:
0202 E571            409         MOV A, 071h
0204 B57051          410         CJNE A, 070h, EA_INIT
                     411         
                     412         ; Check D key (Close)
0207 E561            413         MOV A, 061h
0209 6017            414         JZ EA_CHECK_REQ
020B E560            415         MOV A, 060h
020D 540F            416         ANL A, #0Fh
020F B40D10          417         CJNE A, #0Dh, EA_CHECK_REQ
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     8

                     418         ; D pressed -> Close
0212 757023          419         MOV 070h, #ELEV_CLOSE
0215 755702          420         MOV ELEV_TIMER, #02h
0218 755900          421         MOV ONE_SEC_CNT, #00h
021B 7571FF          422         MOV 071h, #0FFh
021E 756100          423         MOV 061h, #00h
0221 22              424         RET
                     425     
0222                 426     EA_CHECK_REQ:
                     427         ; Check for floor keys to set bitmap
0222 120000   F      428         LCALL CHECK_AND_SET_REQUEST
0225 8000            429         SJMP EA_BLINK_LOGIC
                     430     
0227                 431     EA_BLINK_LOGIC:
0227 E559            432         MOV A, ONE_SEC_CNT
0229 C3              433         CLR C
022A 9432            434         SUBB A, #50
022C 5008            435         JNC EA_OFF
                     436         ; ON
022E 752814          437         MOV 028h, #20          ; '0.'
0231 752911          438         MOV 029h, #17          ; 'P.'
0234 8006            439         SJMP EA_TAIL
0236                 440     EA_OFF:
                     441         ; OFF
0236 752825          442         MOV 028h, #37          ; ' '
0239 752925          443         MOV 029h, #37          ; ' '
023C                 444     EA_TAIL:
023C 752A25          445         MOV 02Ah, #37          ; ' '
023F 752B25          446         MOV 02Bh, #37          ; ' '
0242 E556            447         MOV A, CUR_FLr
0244 20E707          448         JB ACC.7, ARR_NEG
0247 752C25          449         MOV 02Ch, #37          ; ' '
024A 85562D          450         MOV 02Dh, CUR_FLr
024D 22              451         RET
024E                 452     ARR_NEG:
024E 752C24          453         MOV 02Ch, #36          ; '-'
0251 E556            454         MOV A, CUR_FLr
0253 F4              455         CPL A
0254 04              456         INC A
0255 F52D            457         MOV 02Dh, A
0257 22              458         RET
0258                 459     EA_INIT:
0258 E570            460         MOV A, 070h
025A F571            461         MOV 071h, A
                     462         
                     463         ; Clear request for current floor (arrived at target)
025C AE56            464         MOV R6, CUR_FLr
025E 120000   F      465         LCALL CLEAR_FLOOR_REQUEST
                     466         
                     467         ; LCD Update
0261 120000   F      468         LCALL LCD_CLEAR
0264 900000   F      469         MOV DPTR, #LCD_MSG_OPEN
0267 120000   F      470         LCALL LCD_SHOW_STR
                     471         
026A 22              472         RET
                     473     
026B                 474     ELEV_CLOSE_HANDLER:
026B E571            475         MOV A, 071h
026D B57047          476         CJNE A, 070h, EC_INIT
                     477         
                     478         ; Check C key (Reopen) or Current Floor Key
0270 E561            479         MOV A, 061h
0272 601C            480         JZ EC_CHECK_REQ
0274 E560            481         MOV A, 060h
0276 540F            482         ANL A, #0Fh
0278 B40C02          483         CJNE A, #0Ch, EC_CHECK_CUR
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE     9

                     484         ; C pressed -> Reopen
027B 8003            485         SJMP EC_REOPEN
027D                 486     EC_CHECK_CUR:
027D B55610          487         CJNE A, CUR_FLr, EC_CHECK_REQ
                     488         ; Current Floor pressed -> Reopen
0280                 489     EC_REOPEN:
0280 757022          490         MOV 070h, #ELEV_ARRIVED
0283 755705          491         MOV ELEV_TIMER, #05h
0286 755900          492         MOV ONE_SEC_CNT, #00h
0289 7571FF          493         MOV 071h, #0FFh
028C 756100          494         MOV 061h, #00h
028F 22              495         RET
                     496     
0290                 497     EC_CHECK_REQ:
0290 120000   F      498         LCALL CHECK_AND_SET_REQUEST
0293 8000            499         SJMP EC_BLINK_LOGIC
                     500     
0295                 501     EC_BLINK_LOGIC:
0295 E559            502         MOV A, ONE_SEC_CNT
0297 C3              503         CLR C
0298 9432            504         SUBB A, #50
029A 5008            505         JNC EC_OFF
                     506         ; ON
029C 75280C          507         MOV 028h, #12          ; 'C'
029F 752913          508         MOV 029h, #19          ; 'L'
02A2 8006            509         SJMP EC_TAIL
02A4                 510     EC_OFF:
02A4 752825          511         MOV 028h, #37
02A7 752925          512         MOV 029h, #37
02AA                 513     EC_TAIL:
02AA 752A25          514         MOV 02Ah, #37
02AD 752B25          515         MOV 02Bh, #37
02B0 752C25          516         MOV 02Ch, #37
02B3 752D25          517         MOV 02Dh, #37
02B6 22              518         RET
02B7                 519     EC_INIT:
02B7 E570            520         MOV A, 070h
02B9 F571            521         MOV 071h, A
                     522         ; MOV P2, #00h           ; Closing: LEDs ON (Removed for LCD compatibility)
                     523         
                     524         ; LCD Update
02BB 120000   F      525         LCALL LCD_CLEAR
02BE 900000   F      526         MOV DPTR, #LCD_MSG_CLOSE
02C1 120000   F      527         LCALL LCD_SHOW_STR
                     528         
02C4 22              529         RET
                     530     
                     531     ; Show open floor helper (Now shows FL + Floor for Idle)
02C5                 532     SHOW_OPEN_FLOOR:
02C5 120000   F      533         LCALL LCD_CLEAR ; Ensure clear
                     534         
                     535         ; Line 1: Welcome
02C8 7480            536         MOV A, #80h
02CA 120000   F      537         LCALL LCD_WR_CMD
02CD 900000   F      538         MOV DPTR, #LCD_MSG_WELCOME
02D0 120000   F      539         LCALL LCD_SHOW_STR
                     540     
                     541         ; Line 2: FL: [Floor]
02D3 74C0            542         MOV A, #0C0h
02D5 120000   F      543         LCALL LCD_WR_CMD
02D8 900000   F      544         MOV DPTR, #LCD_MSG_FL
02DB 120000   F      545         LCALL LCD_SHOW_STR
02DE AE56            546         MOV R6, CUR_FLr
02E0 120000   F      547         LCALL LCD_PRINT_FLOOR
                     548         
                     549         ; LED6 Update
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    10

02E3 75280F          550         MOV 028h, #15          ; 'F'
02E6 752913          551         MOV 029h, #19          ; 'L'
02E9 752A25          552         MOV 02Ah, #37          ; ' '
02EC 752B25          553         MOV 02Bh, #37          ; ' '
02EF E556            554         MOV A, CUR_FLr
02F1 20E707          555         JB ACC.7, SOF_NEG
02F4 752C25          556         MOV 02Ch, #37          ; ' '
02F7 85562D          557         MOV 02Dh, CUR_FLr
02FA 22              558         RET
02FB                 559     SOF_NEG:
02FB 752C24          560         MOV 02Ch, #36          ; '-'
02FE E556            561         MOV A, CUR_FLr
0300 F4              562         CPL A
0301 04              563         INC A
0302 F52D            564         MOV 02Dh, A
0304 22              565         RET
                     566     
                     567     ; ---------------------------------------------------------
                     568     ; Queue Helper Functions
                     569     ; ---------------------------------------------------------
                     570     
                     571     ; Check if key is floor key (0-9), if so push to queue
                     572     ; Mapping:
                     573     ; Key 0 -> Floor -2 (FEh)
                     574     ; Key 1 -> Floor -1 (FFh)
                     575     ; Key 2 -> Floor 1  (01h)
                     576     ; ...
                     577     ; Key 9 -> Floor 8  (08h)
                     578     ; Key E (14) -> External Up (Push CUR_FLr to EXT_Q)
                     579     ; Key F (15) -> External Down (Push CUR_FLr to EXT_Q)
                     580     ; Helper to map Key (R7) to Floor (R6). CY=1 if valid.
0305                 581     GET_FLOOR_FROM_KEY:
0305 EF              582         MOV A, R7
0306 C3              583         CLR C
0307 940A            584         SUBB A, #0Ah
0309 5011            585         JNC GFK_INVALID      ; If Key >= 10, return CY=0
                     586     
                     587         ; Key is 0-9
030B EF              588         MOV A, R7
030C 6006            589         JZ GFK_KEY_0     ; If Key == 0
                     590         
030E 14              591         DEC A            ; A = Key - 1
030F 6007            592         JZ GFK_KEY_1     ; If Key == 1 (A became 0)
                     593         
                     594         ; Key >= 2, Target = Key - 1
0311 FE              595         MOV R6, A
0312 D3              596         SETB C
0313 22              597         RET
                     598     
0314                 599     GFK_KEY_0:
0314 7EFE            600         MOV R6, #0FEh    ; -2
0316 D3              601         SETB C
0317 22              602         RET
                     603     
0318                 604     GFK_KEY_1:
0318 7EFF            605         MOV R6, #0FFh    ; -1
031A D3              606         SETB C
031B 22              607         RET
                     608     
031C                 609     GFK_INVALID:
031C C3              610         CLR C
031D 22              611         RET
                     612     
                     613     ; Helper to print Floor Number (R6) to LCD at current cursor
031E                 614     LCD_PRINT_FLOOR:
031E EE              615         MOV A, R6
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    11

031F 20E70C          616         JB ACC.7, LPF_NEG
                     617         ; Positive
0322 7420            618         MOV A, #' '
0324 120000   F      619         LCALL LCD_WR_DAT
0327 EE              620         MOV A, R6
0328 2430            621         ADD A, #'0'
032A 120000   F      622         LCALL LCD_WR_DAT
032D 22              623         RET
032E                 624     LPF_NEG:
032E 742D            625         MOV A, #'-'
0330 120000   F      626         LCALL LCD_WR_DAT
0333 EE              627         MOV A, R6
0334 F4              628         CPL A
0335 04              629         INC A
0336 2430            630         ADD A, #'0'
0338 120000   F      631         LCALL LCD_WR_DAT
033B 22              632         RET
                     633     
                     634     ; Helper to show Outside Status
                     635     ; R6 = Floor, R5 = Action (0=None, 1=Up, 2=Down)
033C                 636     SHOW_OUTSIDE_STATUS:
033C 7480            637         MOV A, #80h
033E 120000   F      638         LCALL LCD_WR_CMD
                     639         
0341 900000   F      640         MOV DPTR, #LCD_STR_OUT_PREFIX
0344 120000   F      641         LCALL LCD_SHOW_STR
                     642         
0347 120000   F      643         LCALL LCD_PRINT_FLOOR
                     644         
034A 7420            645         MOV A, #' '
034C 120000   F      646         LCALL LCD_WR_DAT
                     647         
034F ED              648         MOV A, R5
0350 6011            649         JZ SOS_NONE
0352 14              650         DEC A
0353 6007            651         JZ SOS_UP
                     652         ; Down
0355 900000   F      653         MOV DPTR, #LCD_STR_DOWN
0358 120000   F      654         LCALL LCD_SHOW_STR
035B 22              655         RET
035C                 656     SOS_UP:
035C 900000   F      657         MOV DPTR, #LCD_STR_UP
035F 120000   F      658         LCALL LCD_SHOW_STR
0362 22              659         RET
0363                 660     SOS_NONE:
0363 900000   F      661         MOV DPTR, #LCD_STR_EMPTY
0366 120000   F      662         LCALL LCD_SHOW_STR
0369 22              663         RET
                     664     
036A                 665     CHECK_AND_SET_REQUEST:
036A E561            666         MOV A, 061h
036C 6078            667         JZ CASR_RET
036E E560            668         MOV A, 060h
0370 540F            669         ANL A, #0Fh
0372 FF              670         MOV R7, A
                     671         
                     672         ; Check for 'A' (Mode Switch)
0373 BF0A20          673         CJNE R7, #0Ah, CASR_CHK_MODE
                     674         
                     675         ; Toggle Mode
0376 E565            676         MOV A, INPUT_MODE
0378 6401            677         XRL A, #01h
037A F565            678         MOV INPUT_MODE, A
                     679         
                     680         ; Update LCD
037C E565            681         MOV A, INPUT_MODE
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    12

037E 6009            682         JZ CASR_SHOW_INSIDE
                     683         
                     684         ; Show Outside (Default Select)
0380 AE66            685         MOV R6, OUT_SEL_VAL
0382 7D00            686         MOV R5, #00h
0384 120000   F      687         LCALL SHOW_OUTSIDE_STATUS
0387 805A            688         SJMP CASR_CONSUME
                     689         
0389                 690     CASR_SHOW_INSIDE:
0389 7480            691         MOV A, #80h
038B 120000   F      692         LCALL LCD_WR_CMD
038E 900000   F      693         MOV DPTR, #LCD_MSG_INSIDE
0391 120000   F      694         LCALL LCD_SHOW_STR
0394 804D            695         SJMP CASR_CONSUME
                     696     
0396                 697     CASR_CHK_MODE:
0396 E565            698         MOV A, INPUT_MODE
0398 7014            699         JNZ CASR_OUTSIDE_MODE
                     700         
                     701         ; --- INSIDE MODE ---
                     702         ; Check 0-9
039A 120000   F      703         LCALL GET_FLOOR_FROM_KEY
039D 5005            704         JNC CASR_IN_CHK_OTHER
                     705         ; Valid Floor in R6 -> Set Internal Bitmap
039F 120000   F      706         LCALL SET_INT_REQUEST
03A2 803F            707         SJMP CASR_CONSUME
                     708         
03A4                 709     CASR_IN_CHK_OTHER:
                     710         ; Check E/F -> Ignore
03A4 BF0E02          711         CJNE R7, #0Eh, CASR_IN_CHK_F
03A7 803A            712         SJMP CASR_CONSUME
03A9                 713     CASR_IN_CHK_F:
03A9 BF0F3A          714         CJNE R7, #0Fh, CASR_RET
03AC 8035            715         SJMP CASR_CONSUME
                     716     
                     717         ; --- OUTSIDE MODE ---
03AE                 718     CASR_OUTSIDE_MODE:
                     719         ; Check 0-9
03AE 120000   F      720         LCALL GET_FLOOR_FROM_KEY
03B1 5009            721         JNC CASR_OUT_CHK_OTHER
                     722         ; Valid Floor -> Store selection
03B3 8E66            723         MOV OUT_SEL_VAL, R6
                     724         ; Update Display
03B5 7D00            725         MOV R5, #00h
03B7 120000   F      726         LCALL SHOW_OUTSIDE_STATUS
03BA 8027            727         SJMP CASR_CONSUME
                     728     
03BC                 729     CASR_OUT_CHK_OTHER:
                     730         ; Check E/F -> Set External Bitmap
03BC BF0E09          731         CJNE R7, #0Eh, CASR_OUT_CHK_F
                     732         ; Key E (Up)
03BF AE66            733         MOV R6, OUT_SEL_VAL
03C1 120000   F      734         LCALL SET_EXT_UP_REQUEST
03C4 7D01            735         MOV R5, #01h
03C6 800A            736         SJMP CASR_OUT_SHOW
03C8                 737     CASR_OUT_CHK_F:
03C8 BF0F0E          738         CJNE R7, #0Fh, CASR_OUT_CHK_CD
                     739         ; Key F (Down)
03CB AE66            740         MOV R6, OUT_SEL_VAL
03CD 120000   F      741         LCALL SET_EXT_DN_REQUEST
03D0 7D02            742         MOV R5, #02h
                     743         
03D2                 744     CASR_OUT_SHOW:
03D2 AE66            745         MOV R6, OUT_SEL_VAL
03D4 120000   F      746         LCALL SHOW_OUTSIDE_STATUS
03D7 800A            747         SJMP CASR_CONSUME
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    13

                     748     
03D9                 749     CASR_OUT_CHK_CD:
                     750         ; Check C/D -> Consume (Ignore)
03D9 BF0C02          751         CJNE R7, #0Ch, CASR_OUT_CHK_D
03DC 8005            752         SJMP CASR_CONSUME
03DE                 753     CASR_OUT_CHK_D:
03DE BF0D05          754         CJNE R7, #0Dh, CASR_RET
03E1 8000            755         SJMP CASR_CONSUME
                     756     
03E3                 757     CASR_CONSUME:
03E3 756100          758         MOV 061h, #00h
03E6                 759     CASR_RET:
03E6 22              760         RET
                     761     
                     762     ; ---------------------------------------------------------
                     763     ; Bitmap Helper Functions
                     764     ; ---------------------------------------------------------
                     765     
                     766     ; Convert Floor (R6) to Bit Index (R4)
                     767     ; Floor -2 -> Index 0, Floor -1 -> Index 1
                     768     ; Floor 1 -> Index 2, Floor 2 -> Index 3, ... Floor 8 -> Index 10
                     769     ; Returns: R4 = bit index (0-10)
03E7                 770     FLOOR_TO_INDEX:
03E7 EE              771         MOV A, R6
03E8 20E703          772         JB ACC.7, FTI_NEG
                     773         ; Positive floor (1-8) -> Index = Floor + 1
03EB 04              774         INC A
03EC FC              775         MOV R4, A
03ED 22              776         RET
03EE                 777     FTI_NEG:
                     778         ; Negative floor: -2 (FEh) -> 0, -1 (FFh) -> 1
                     779         ; Index = Floor + 2
03EE 2402            780         ADD A, #02h
03F0 FC              781         MOV R4, A
03F1 22              782         RET
                     783     
                     784     ; Convert Bit Index (R4) to Floor (R6)
03F2                 785     INDEX_TO_FLOOR:
03F2 EC              786         MOV A, R4
03F3 B40003          787         CJNE A, #00h, ITF_CHK1
03F6 7EFE            788         MOV R6, #0FEh   ; -2
03F8 22              789         RET
03F9                 790     ITF_CHK1:
03F9 B40103          791         CJNE A, #01h, ITF_POS
03FC 7EFF            792         MOV R6, #0FFh   ; -1
03FE 22              793         RET
03FF                 794     ITF_POS:
                     795         ; Index >= 2: Floor = Index - 1
03FF 14              796         DEC A
0400 FE              797         MOV R6, A
0401 22              798         RET
                     799     
                     800     ; Set bit for floor R6 in Internal Request bitmap
0402                 801     SET_INT_REQUEST:
0402 120000   F      802         LCALL FLOOR_TO_INDEX
                     803         ; R4 = bit index
0405 EC              804         MOV A, R4
0406 C3              805         CLR C
0407 9408            806         SUBB A, #08h
0409 5009            807         JNC SIR_HI
                     808         ; Low byte (index 0-7)
040B 120000   F      809         LCALL GET_BIT_MASK   ; R3 = mask for bit R4
040E E55C            810         MOV A, INT_REQ_LO
0410 4B              811         ORL A, R3
0411 F55C            812         MOV INT_REQ_LO, A
0413 22              813         RET
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    14

0414                 814     SIR_HI:
                     815         ; High byte (index 8-10)
0414 EC              816         MOV A, R4
0415 C3              817         CLR C
0416 9408            818         SUBB A, #08h
0418 FC              819         MOV R4, A
0419 120000   F      820         LCALL GET_BIT_MASK
041C E55D            821         MOV A, INT_REQ_HI
041E 4B              822         ORL A, R3
041F F55D            823         MOV INT_REQ_HI, A
0421 22              824         RET
                     825     
                     826     ; Set bit for floor R6 in External UP Request bitmap
0422                 827     SET_EXT_UP_REQUEST:
0422 120000   F      828         LCALL FLOOR_TO_INDEX
0425 EC              829         MOV A, R4
0426 C3              830         CLR C
0427 9408            831         SUBB A, #08h
0429 5009            832         JNC SEUR_HI
042B 120000   F      833         LCALL GET_BIT_MASK
042E E55E            834         MOV A, EXT_UP_LO
0430 4B              835         ORL A, R3
0431 F55E            836         MOV EXT_UP_LO, A
0433 22              837         RET
0434                 838     SEUR_HI:
0434 EC              839         MOV A, R4
0435 C3              840         CLR C
0436 9408            841         SUBB A, #08h
0438 FC              842         MOV R4, A
0439 120000   F      843         LCALL GET_BIT_MASK
043C E55F            844         MOV A, EXT_UP_HI
043E 4B              845         ORL A, R3
043F F55F            846         MOV EXT_UP_HI, A
0441 22              847         RET
                     848     
                     849     ; Set bit for floor R6 in External DOWN Request bitmap
0442                 850     SET_EXT_DN_REQUEST:
0442 120000   F      851         LCALL FLOOR_TO_INDEX
0445 EC              852         MOV A, R4
0446 C3              853         CLR C
0447 9408            854         SUBB A, #08h
0449 5009            855         JNC SEDR_HI
044B 120000   F      856         LCALL GET_BIT_MASK
044E E562            857         MOV A, EXT_DN_LO
0450 4B              858         ORL A, R3
0451 F562            859         MOV EXT_DN_LO, A
0453 22              860         RET
0454                 861     SEDR_HI:
0454 EC              862         MOV A, R4
0455 C3              863         CLR C
0456 9408            864         SUBB A, #08h
0458 FC              865         MOV R4, A
0459 120000   F      866         LCALL GET_BIT_MASK
045C E563            867         MOV A, EXT_DN_HI
045E 4B              868         ORL A, R3
045F F563            869         MOV EXT_DN_HI, A
0461 22              870         RET
                     871     
                     872     ; Get bit mask for bit index R4 (0-7), return in R3
0462                 873     GET_BIT_MASK:
0462 EC              874         MOV A, R4
0463 900000   F      875         MOV DPTR, #BIT_MASK_TBL
0466 93              876         MOVC A, @A+DPTR
0467 FB              877         MOV R3, A
0468 22              878         RET
                     879     
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    15

0469                 880     BIT_MASK_TBL:
0469 01020408        881         DB 001h, 002h, 004h, 008h, 010h, 020h, 040h, 080h
046D 10204080                
                     882     
                     883     ; Clear request for floor R6 from all bitmaps
0471                 884     CLEAR_FLOOR_REQUEST:
0471 120000   F      885         LCALL FLOOR_TO_INDEX
0474 EC              886         MOV A, R4
0475 C3              887         CLR C
0476 9408            888         SUBB A, #08h
0478 5016            889         JNC CFR_HI
                     890         ; Low byte
047A 120000   F      891         LCALL GET_BIT_MASK
047D EB              892         MOV A, R3
047E F4              893         CPL A           ; Invert mask
047F FB              894         MOV R3, A
0480 E55C            895         MOV A, INT_REQ_LO
0482 5B              896         ANL A, R3
0483 F55C            897         MOV INT_REQ_LO, A
0485 E55E            898         MOV A, EXT_UP_LO
0487 5B              899         ANL A, R3
0488 F55E            900         MOV EXT_UP_LO, A
048A E562            901         MOV A, EXT_DN_LO
048C 5B              902         ANL A, R3
048D F562            903         MOV EXT_DN_LO, A
048F 22              904         RET
0490                 905     CFR_HI:
0490 EC              906         MOV A, R4
0491 C3              907         CLR C
0492 9408            908         SUBB A, #08h
0494 FC              909         MOV R4, A
0495 120000   F      910         LCALL GET_BIT_MASK
0498 EB              911         MOV A, R3
0499 F4              912         CPL A
049A FB              913         MOV R3, A
049B E55D            914         MOV A, INT_REQ_HI
049D 5B              915         ANL A, R3
049E F55D            916         MOV INT_REQ_HI, A
04A0 E55F            917         MOV A, EXT_UP_HI
04A2 5B              918         ANL A, R3
04A3 F55F            919         MOV EXT_UP_HI, A
04A5 E563            920         MOV A, EXT_DN_HI
04A7 5B              921         ANL A, R3
04A8 F563            922         MOV EXT_DN_HI, A
04AA 22              923         RET
                     924     
                     925     ; Check if there's any request at floor R6
                     926     ; Returns CY=1 if request exists
04AB                 927     CHECK_FLOOR_REQUEST:
04AB 120000   F      928         LCALL FLOOR_TO_INDEX
04AE EC              929         MOV A, R4
04AF C3              930         CLR C
04B0 9408            931         SUBB A, #08h
04B2 5020            932         JNC CHKFR_HI
                     933         
                     934         ; Low Byte
04B4 120000   F      935         LCALL GET_BIT_MASK
                     936         ; Check Internal
04B7 E55C            937         MOV A, INT_REQ_LO
04B9 5B              938         ANL A, R3
04BA 703F            939         JNZ CHKFR_FOUND
                     940         
                     941         ; Check External - Dir dependent
04BC E564            942         MOV A, ELEV_DIR
04BE B40202          943         CJNE A, #02h, CFR_LO_CHK_UP  ; If Dir != 2 (0 or 1), check UP
04C1 800A            944         SJMP CFR_LO_CHK_DN           ; If Dir == 2, check DOWN only
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    16

                     945         
04C3                 946     CFR_LO_CHK_UP:
04C3 E55E            947         MOV A, EXT_UP_LO
04C5 5B              948         ANL A, R3
04C6 7033            949         JNZ CHKFR_FOUND
                     950         
                     951         ; If Dir=1 (Up), we are done (don't check down)
04C8 E564            952         MOV A, ELEV_DIR
04CA B4002C          953         CJNE A, #00h, CHKFR_NOTFOUND ; If Dir != 0 (i.e. 1), Ret Not Found
                     954         
                     955         ; If Dir=0, Fall through to check DOWN
                     956         
04CD                 957     CFR_LO_CHK_DN:
04CD E562            958         MOV A, EXT_DN_LO
04CF 5B              959         ANL A, R3
04D0 7029            960         JNZ CHKFR_FOUND
04D2 8025            961         SJMP CHKFR_NOTFOUND
                     962         
04D4                 963     CHKFR_HI:
                     964         ; High Byte adjustment logic
04D4 EC              965         MOV A, R4
04D5 C3              966         CLR C
04D6 9408            967         SUBB A, #08h
04D8 FC              968         MOV R4, A
04D9 120000   F      969         LCALL GET_BIT_MASK
                     970         
                     971         ; Check Internal
04DC E55D            972         MOV A, INT_REQ_HI
04DE 5B              973         ANL A, R3
04DF 701A            974         JNZ CHKFR_FOUND
                     975         
                     976         ; Check External
04E1 E564            977         MOV A, ELEV_DIR
04E3 B40202          978         CJNE A, #02h, CFR_HI_CHK_UP
04E6 800A            979         SJMP CFR_HI_CHK_DN
                     980         
04E8                 981     CFR_HI_CHK_UP:
04E8 E55F            982         MOV A, EXT_UP_HI
04EA 5B              983         ANL A, R3
04EB 700E            984         JNZ CHKFR_FOUND
                     985         
04ED E564            986         MOV A, ELEV_DIR
04EF B40007          987         CJNE A, #00h, CHKFR_NOTFOUND
                     988         
04F2                 989     CFR_HI_CHK_DN:
04F2 E563            990         MOV A, EXT_DN_HI
04F4 5B              991         ANL A, R3
04F5 7004            992         JNZ CHKFR_FOUND
04F7 8000            993         SJMP CHKFR_NOTFOUND
                     994         
04F9                 995     CHKFR_NOTFOUND:
04F9 C3              996         CLR C
04FA 22              997         RET
04FB                 998     CHKFR_FOUND:
04FB D3              999         SETB C
04FC 22             1000         RET
                    1001     
                    1002     ; ---------------------------------------------------------
                    1003     ; SCAN Algorithm: Find next target floor
                    1004     ; Returns: R6 = target floor, CY=1 if found, CY=0 if no request
                    1005     ; ---------------------------------------------------------
04FD                1006     SCAN_FIND_NEXT_TARGET:
                    1007         ; First check if any request exists
04FD E55C           1008         MOV A, INT_REQ_LO
04FF 455D           1009         ORL A, INT_REQ_HI
0501 455E           1010         ORL A, EXT_UP_LO
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    17

0503 455F           1011         ORL A, EXT_UP_HI
0505 4562           1012         ORL A, EXT_DN_LO
0507 4563           1013         ORL A, EXT_DN_HI
0509 7002           1014         JNZ SCAN_HAS_REQ
050B C3             1015         CLR C
050C 22             1016         RET
                    1017     
050D                1018     SCAN_HAS_REQ:
                    1019         ; Get current floor index
050D AE56           1020         MOV R6, CUR_FLr
050F 120000   F     1021         LCALL FLOOR_TO_INDEX
0512 EC             1022         MOV A, R4
0513 FD             1023         MOV R5, A         ; R5 = current index
                    1024         
                    1025         ; R2 = tried flags: bit0=tried up, bit1=tried down
0514 7A00           1026         MOV R2, #00h
                    1027         
                    1028         ; Check direction: if stopped (0), default to up (1)
0516 E564           1029         MOV A, ELEV_DIR
0518 6005           1030         JZ SCAN_DEFAULT_UP
051A B40205         1031         CJNE A, #02h, SCAN_TRY_UP
051D 8024           1032         SJMP SCAN_TRY_DOWN
                    1033         
051F                1034     SCAN_DEFAULT_UP:
051F 756401         1035         MOV ELEV_DIR, #01h   ; Default direction up
                    1036     
0522                1037     SCAN_TRY_UP:
                    1038         ; Mark that we tried up
0522 EA             1039         MOV A, R2
0523 4401           1040         ORL A, #01h
0525 FA             1041         MOV R2, A
                    1042         
                    1043         ; Try to find request above or at current floor
0526 ED             1044         MOV A, R5
0527 FC             1045         MOV R4, A         ; Start from current index
0528                1046     SCAN_UP_LOOP:
                    1047         ; Check if there's request at R4
0528 120000   F     1048         LCALL INDEX_TO_FLOOR
052B EE             1049         MOV A, R6
052C B55602         1050         CJNE A, CUR_FLr, SCAN_UP_CHK
052F 8005           1051         SJMP SCAN_UP_NEXT  ; Skip current floor
0531                1052     SCAN_UP_CHK:
0531 120000   F     1053         LCALL SCAN_CHECK_UP_REQUEST
0534 4030           1054         JC SCAN_FOUND
0536                1055     SCAN_UP_NEXT:
0536 0C             1056         INC R4
0537 EC             1057         MOV A, R4
0538 B40BED         1058         CJNE A, #11, SCAN_UP_LOOP
                    1059         
                    1060         ; No request above, check if we already tried down
053B EA             1061         MOV A, R2
053C 5402           1062         ANL A, #02h
053E 7021           1063         JNZ SCAN_FAIL       ; Already tried down
                    1064         
                    1065         ; Switch to down
0540 756402         1066         MOV ELEV_DIR, #02h
                    1067         ; Fall through to SCAN_TRY_DOWN
                    1068     
0543                1069     SCAN_TRY_DOWN:
                    1070         ; Mark that we tried down
0543 EA             1071         MOV A, R2
0544 4402           1072         ORL A, #02h
0546 FA             1073         MOV R2, A
                    1074         
                    1075         ; Try to find request below current floor
0547 ED             1076         MOV A, R5
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    18

0548 FC             1077         MOV R4, A         ; Start from current index
0549                1078     SCAN_DN_LOOP:
0549 EC             1079         MOV A, R4
054A 600B           1080         JZ SCAN_DN_DONE   ; Reached bottom
054C 1C             1081         DEC R4
054D 120000   F     1082         LCALL INDEX_TO_FLOOR
0550 120000   F     1083         LCALL SCAN_CHECK_DN_REQUEST
0553 4011           1084         JC SCAN_FOUND
0555 80F2           1085         SJMP SCAN_DN_LOOP
                    1086     
0557                1087     SCAN_DN_DONE:
                    1088         ; No request below, check if we already tried up
0557 EA             1089         MOV A, R2
0558 5401           1090         ANL A, #01h
055A 7005           1091         JNZ SCAN_FAIL       ; Already tried up
                    1092         
                    1093         ; Switch to up
055C 756401         1094         MOV ELEV_DIR, #01h
055F 80C1           1095         SJMP SCAN_TRY_UP
                    1096     
0561                1097     SCAN_FAIL:
0561 756400         1098         MOV ELEV_DIR, #00h   ; Reset direction
0564 C3             1099         CLR C
0565 22             1100         RET
                    1101     
0566                1102     SCAN_FOUND:
                    1103         ; R6 has the target floor
0566 D3             1104         SETB C
0567 22             1105         RET
                    1106     
                    1107     ; Check if floor R6 has request for UP direction
                    1108     ; (Internal or External UP)
0568                1109     SCAN_CHECK_UP_REQUEST:
0568 C004           1110         PUSH 04h
056A 120000   F     1111         LCALL FLOOR_TO_INDEX
056D EC             1112         MOV A, R4
056E C3             1113         CLR C
056F 9408           1114         SUBB A, #08h
0571 500F           1115         JNC SCUR_HI
0573 120000   F     1116         LCALL GET_BIT_MASK
                    1117         ; Always check Internal
0576 E55C           1118         MOV A, INT_REQ_LO
0578 5B             1119         ANL A, R3
0579 701D           1120         JNZ SCUR_FOUND
                    1121         ; Also check External UP
057B E55E           1122         MOV A, EXT_UP_LO
057D 5B             1123         ANL A, R3
057E 7018           1124         JNZ SCUR_FOUND
0580 8012           1125         SJMP SCUR_NOTFOUND
0582                1126     SCUR_HI:
0582 EC             1127         MOV A, R4
0583 C3             1128         CLR C
0584 9408           1129         SUBB A, #08h
0586 FC             1130         MOV R4, A
0587 120000   F     1131         LCALL GET_BIT_MASK
058A E55D           1132         MOV A, INT_REQ_HI
058C 5B             1133         ANL A, R3
058D 7009           1134         JNZ SCUR_FOUND
058F E55F           1135         MOV A, EXT_UP_HI
0591 5B             1136         ANL A, R3
0592 7004           1137         JNZ SCUR_FOUND
0594                1138     SCUR_NOTFOUND:
0594 D004           1139         POP 04h
0596 C3             1140         CLR C
0597 22             1141         RET
0598                1142     SCUR_FOUND:
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    19

0598 D004           1143         POP 04h
059A D3             1144         SETB C
059B 22             1145         RET
                    1146     
                    1147     ; Check if floor R6 has request for DOWN direction
                    1148     ; (Internal or External DOWN)
059C                1149     SCAN_CHECK_DN_REQUEST:
059C C004           1150         PUSH 04h
059E 120000   F     1151         LCALL FLOOR_TO_INDEX
05A1 EC             1152         MOV A, R4
05A2 C3             1153         CLR C
05A3 9408           1154         SUBB A, #08h
05A5 500F           1155         JNC SCDR_HI
05A7 120000   F     1156         LCALL GET_BIT_MASK
                    1157         ; Always check Internal
05AA E55C           1158         MOV A, INT_REQ_LO
05AC 5B             1159         ANL A, R3
05AD 701D           1160         JNZ SCDR_FOUND
                    1161         ; Also check External DOWN
05AF E562           1162         MOV A, EXT_DN_LO
05B1 5B             1163         ANL A, R3
05B2 7018           1164         JNZ SCDR_FOUND
05B4 8012           1165         SJMP SCDR_NOTFOUND
05B6                1166     SCDR_HI:
05B6 EC             1167         MOV A, R4
05B7 C3             1168         CLR C
05B8 9408           1169         SUBB A, #08h
05BA FC             1170         MOV R4, A
05BB 120000   F     1171         LCALL GET_BIT_MASK
05BE E55D           1172         MOV A, INT_REQ_HI
05C0 5B             1173         ANL A, R3
05C1 7009           1174         JNZ SCDR_FOUND
05C3 E563           1175         MOV A, EXT_DN_HI
05C5 5B             1176         ANL A, R3
05C6 7004           1177         JNZ SCDR_FOUND
05C8                1178     SCDR_NOTFOUND:
05C8 D004           1179         POP 04h
05CA C3             1180         CLR C
05CB 22             1181         RET
05CC                1182     SCDR_FOUND:
05CC D004           1183         POP 04h
05CE D3             1184         SETB C
05CF 22             1185         RET
                    1186     
                    1187     ; ---------------------------------------------------------
                    1188     ; Display Helpers
                    1189     ; ---------------------------------------------------------
                    1190     
                    1191     ; Update Current Floor at 02Ah/02Bh
05D0                1192     UPDATE_CUR_DISPLAY:
05D0 E556           1193         MOV A, CUR_FLr
05D2 20E707         1194         JB ACC.7, UCD_NEG
05D5 752A25         1195         MOV 02Ah, #37      ; Space
05D8 85562B         1196         MOV 02Bh, CUR_FLr
05DB 22             1197         RET
05DC                1198     UCD_NEG:
05DC 752A24         1199         MOV 02Ah, #36      ; '-'
05DF E556           1200         MOV A, CUR_FLr
05E1 F4             1201         CPL A
05E2 04             1202         INC A
05E3 F52B           1203         MOV 02Bh, A
05E5 22             1204         RET
                    1205     
                    1206     ; Update Target Floor at 02Ch/02Dh
05E6                1207     UPDATE_TGT_DISPLAY:
05E6 E558           1208         MOV A, ELEV_TARGET
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    20

05E8 20E707         1209         JB ACC.7, UTD_NEG
05EB 752C25         1210         MOV 02Ch, #37      ; Space
05EE 85582D         1211         MOV 02Dh, ELEV_TARGET
05F1 22             1212         RET
05F2                1213     UTD_NEG:
05F2 752C24         1214         MOV 02Ch, #36      ; '-'
05F5 E558           1215         MOV A, ELEV_TARGET
05F7 F4             1216         CPL A
05F8 04             1217         INC A
05F9 F52D           1218         MOV 02Dh, A
05FB 22             1219         RET
                    1220     
                    1221     END
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    21

SYMBOL TABLE LISTING
------ ----- -------


N A M E                T Y P E  V A L U E   ATTRIBUTES

ACC . . . . . . . . .  D ADDR   00E0H   A   
ARR_NEG . . . . . . .  C ADDR   024EH   R   SEG=RUNNING
BITMASK_TABLE . . . .  C ADDR   0026H   R   SEG=RUNNING
BIT_MASK_TBL. . . . .  C ADDR   0469H   R   SEG=RUNNING
BLINK_TIMER . . . . .  N NUMB   005AH   A   
BLINK_TOGGLE. . . . .  N NUMB   005BH   A   
CASR_CHK_MODE . . . .  C ADDR   0396H   R   SEG=RUNNING
CASR_CONSUME. . . . .  C ADDR   03E3H   R   SEG=RUNNING
CASR_IN_CHK_F . . . .  C ADDR   03A9H   R   SEG=RUNNING
CASR_IN_CHK_OTHER . .  C ADDR   03A4H   R   SEG=RUNNING
CASR_OUTSIDE_MODE . .  C ADDR   03AEH   R   SEG=RUNNING
CASR_OUT_CHK_CD . . .  C ADDR   03D9H   R   SEG=RUNNING
CASR_OUT_CHK_D. . . .  C ADDR   03DEH   R   SEG=RUNNING
CASR_OUT_CHK_F. . . .  C ADDR   03C8H   R   SEG=RUNNING
CASR_OUT_CHK_OTHER. .  C ADDR   03BCH   R   SEG=RUNNING
CASR_OUT_SHOW . . . .  C ADDR   03D2H   R   SEG=RUNNING
CASR_RET. . . . . . .  C ADDR   03E6H   R   SEG=RUNNING
CASR_SHOW_INSIDE. . .  C ADDR   0389H   R   SEG=RUNNING
CFR_HI. . . . . . . .  C ADDR   0490H   R   SEG=RUNNING
CFR_HI_CHK_DN . . . .  C ADDR   04F2H   R   SEG=RUNNING
CFR_HI_CHK_UP . . . .  C ADDR   04E8H   R   SEG=RUNNING
CFR_LO_CHK_DN . . . .  C ADDR   04CDH   R   SEG=RUNNING
CFR_LO_CHK_UP . . . .  C ADDR   04C3H   R   SEG=RUNNING
CHECK_AND_SET_REQUEST  C ADDR   036AH   R   SEG=RUNNING
CHECK_ELEV_ARR. . . .  C ADDR   0120H   R   SEG=RUNNING
CHECK_ELEV_CLOSE. . .  C ADDR   0127H   R   SEG=RUNNING
CHECK_ELEV_RUN. . . .  C ADDR   0112H   R   SEG=RUNNING
CHECK_ELEV_RUN2 . . .  C ADDR   0119H   R   SEG=RUNNING
CHECK_FLOOR_REQUEST .  C ADDR   04ABH   R   SEG=RUNNING
CHKFR_FOUND . . . . .  C ADDR   04FBH   R   SEG=RUNNING
CHKFR_HI. . . . . . .  C ADDR   04D4H   R   SEG=RUNNING
CHKFR_NOTFOUND. . . .  C ADDR   04F9H   R   SEG=RUNNING
CLEAR_FLOOR_REQUEST .  C ADDR   0471H   R   SEG=RUNNING
CUR_FLR . . . . . . .  N NUMB   0056H   A   
DEBUG_ON. . . . . . .  N NUMB   0067H   A   
EA_BLINK_LOGIC. . . .  C ADDR   0227H   R   SEG=RUNNING
EA_CHECK_REQ. . . . .  C ADDR   0222H   R   SEG=RUNNING
EA_INIT . . . . . . .  C ADDR   0258H   R   SEG=RUNNING
EA_OFF. . . . . . . .  C ADDR   0236H   R   SEG=RUNNING
EA_TAIL . . . . . . .  C ADDR   023CH   R   SEG=RUNNING
ECP_EXEC. . . . . . .  C ADDR   017EH   R   SEG=RUNNING
ECP_GO_8. . . . . . .  C ADDR   017CH   R   SEG=RUNNING
ECP_MOVE. . . . . . .  C ADDR   0186H   R   SEG=RUNNING
ECP_TEST. . . . . . .  C ADDR   0176H   R   SEG=RUNNING
EC_BLINK_LOGIC. . . .  C ADDR   0295H   R   SEG=RUNNING
EC_CHECK_CUR. . . . .  C ADDR   027DH   R   SEG=RUNNING
EC_CHECK_REQ. . . . .  C ADDR   0290H   R   SEG=RUNNING
EC_INIT . . . . . . .  C ADDR   02B7H   R   SEG=RUNNING
EC_OFF. . . . . . . .  C ADDR   02A4H   R   SEG=RUNNING
EC_REOPEN . . . . . .  C ADDR   0280H   R   SEG=RUNNING
EC_TAIL . . . . . . .  C ADDR   02AAH   R   SEG=RUNNING
EH_CHECK_CUR_FL . . .  C ADDR   0144H   R   SEG=RUNNING
EH_OPEN_NOW . . . . .  C ADDR   0150H   R   SEG=RUNNING
EH_SCAN . . . . . . .  C ADDR   015DH   R   SEG=RUNNING
ELEV_ARRIVED. . . . .  N NUMB   0022H   A   
ELEV_ARRIVED_HANDLER.  C ADDR   0202H   R   SEG=RUNNING
ELEV_CHECK_PARK . . .  C ADDR   016DH   R   SEG=RUNNING
ELEV_CLOSE. . . . . .  N NUMB   0023H   A   
ELEV_CLOSE_HANDLER. .  C ADDR   026BH   R   SEG=RUNNING
ELEV_DIFF . . . . . .  C ADDR   0193H   R   SEG=RUNNING
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    22

ELEV_DIR. . . . . . .  N NUMB   0064H   A   
ELEV_HANDLER. . . . .  C ADDR   012FH   R   SEG=RUNNING
ELEV_INIT . . . . . .  C ADDR   0188H   R   SEG=RUNNING
ELEV_RUN. . . . . . .  N NUMB   0021H   A   
ELEV_RUN_HANDLER. . .  C ADDR   01D8H   R   SEG=RUNNING
ELEV_ST . . . . . . .  N NUMB   0020H   A   
ELEV_START_MOVE . . .  C ADDR   016BH   R   SEG=RUNNING
ELEV_TARGET . . . . .  N NUMB   0058H   A   
ELEV_TIMER. . . . . .  N NUMB   0057H   A   
ER_CHK_INT_KEY. . . .  C ADDR   01F9H   R   SEG=RUNNING
ER_INIT . . . . . . .  C ADDR   01FDH   R   SEG=RUNNING
EXT_DN_HI . . . . . .  N NUMB   0063H   A   
EXT_DN_LO . . . . . .  N NUMB   0062H   A   
EXT_UP_HI . . . . . .  N NUMB   005FH   A   
EXT_UP_LO . . . . . .  N NUMB   005EH   A   
E_GO_DOWN . . . . . .  C ADDR   01B3H   R   SEG=RUNNING
E_START . . . . . . .  C ADDR   01BDH   R   SEG=RUNNING
FLOOR_TO_INDEX. . . .  C ADDR   03E7H   R   SEG=RUNNING
FTI_NEG . . . . . . .  C ADDR   03EEH   R   SEG=RUNNING
GET_BIT_MASK. . . . .  C ADDR   0462H   R   SEG=RUNNING
GET_FLOOR_FROM_KEY. .  C ADDR   0305H   R   SEG=RUNNING
GFK_INVALID . . . . .  C ADDR   031CH   R   SEG=RUNNING
GFK_KEY_0 . . . . . .  C ADDR   0314H   R   SEG=RUNNING
GFK_KEY_1 . . . . . .  C ADDR   0318H   R   SEG=RUNNING
INDEX_TO_FLOOR. . . .  C ADDR   03F2H   R   SEG=RUNNING
INPUT_MODE. . . . . .  N NUMB   0065H   A   
INT_REQ_HI. . . . . .  N NUMB   005DH   A   
INT_REQ_LO. . . . . .  N NUMB   005CH   A   
ITF_CHK1. . . . . . .  C ADDR   03F9H   R   SEG=RUNNING
ITF_POS . . . . . . .  C ADDR   03FFH   R   SEG=RUNNING
LCD_CLEAR . . . . . .  C ADDR   -----       EXT
LCD_INIT. . . . . . .  C ADDR   -----       EXT
LCD_MSG_CLOSE . . . .  C ADDR   0079H   R   SEG=RUNNING
LCD_MSG_FL. . . . . .  C ADDR   009BH   R   SEG=RUNNING
LCD_MSG_INSIDE. . . .  C ADDR   0031H   R   SEG=RUNNING
LCD_MSG_OPEN. . . . .  C ADDR   0068H   R   SEG=RUNNING
LCD_MSG_RUN . . . . .  C ADDR   008AH   R   SEG=RUNNING
LCD_MSG_WELCOME . . .  C ADDR   0042H   R   SEG=RUNNING
LCD_PRINT_FLOOR . . .  C ADDR   031EH   R   SEG=RUNNING
LCD_SHOW_STR. . . . .  C ADDR   -----       EXT
LCD_STR_DOWN. . . . .  C ADDR   005EH   R   SEG=RUNNING
LCD_STR_EMPTY . . . .  C ADDR   0063H   R   SEG=RUNNING
LCD_STR_OUT_PREFIX. .  C ADDR   0053H   R   SEG=RUNNING
LCD_STR_UP. . . . . .  C ADDR   0059H   R   SEG=RUNNING
LCD_WR_CMD. . . . . .  C ADDR   -----       EXT
LCD_WR_DAT. . . . . .  C ADDR   -----       EXT
LED6_APPLYTABLE . . .  C ADDR   -----       EXT
LPF_NEG . . . . . . .  C ADDR   032EH   R   SEG=RUNNING
ONE_SEC_CNT . . . . .  N NUMB   0059H   A   
OPT1_ST . . . . . . .  N NUMB   0011H   A   
OPT2_ST . . . . . . .  N NUMB   0012H   A   
OPT3_ST . . . . . . .  N NUMB   0013H   A   
OPT_ST. . . . . . . .  N NUMB   0001H   A   
OUT_SEL_VAL . . . . .  N NUMB   0066H   A   
PASSWORD_TABLE. . . .  C ADDR   002CH   R   SEG=RUNNING
PASS_ST . . . . . . .  N NUMB   0002H   A   
RT_CONFIG_DONE. . . .  C ADDR   010BH   R   SEG=RUNNING
RT_HANDLE_KEY . . . .  C ADDR   00E5H   R   SEG=RUNNING
RT_HANDLE_OTHER . . .  C ADDR   00F2H   R   SEG=RUNNING
RT_INIT . . . . . . .  C ADDR   00F7H   R   SEG=RUNNING
RT_MODE . . . . . . .  C ADDR   00FDH   R   SEG=RUNNING
RT_RETURN . . . . . .  C ADDR   012EH   R   SEG=RUNNING
RUNNING . . . . . . .  C SEG    05FCH       REL=UNIT
RUNNINGTASK_HANDLER .  C ADDR   00D4H   R   SEG=RUNNING
RUNNINGTASK_INIT. . .  C ADDR   00A0H   R   SEG=RUNNING
RUN_ST. . . . . . . .  N NUMB   0000H   A   
A51 MACRO ASSEMBLER  RUNNINGTASK                                                          01/06/2026 22:05:32 PAGE    23

SCAN_CHECK_DN_REQUEST  C ADDR   059CH   R   SEG=RUNNING
SCAN_CHECK_UP_REQUEST  C ADDR   0568H   R   SEG=RUNNING
SCAN_DEFAULT_UP . . .  C ADDR   051FH   R   SEG=RUNNING
SCAN_DN_DONE. . . . .  C ADDR   0557H   R   SEG=RUNNING
SCAN_DN_LOOP. . . . .  C ADDR   0549H   R   SEG=RUNNING
SCAN_FAIL . . . . . .  C ADDR   0561H   R   SEG=RUNNING
SCAN_FIND_NEXT_TARGET  C ADDR   04FDH   R   SEG=RUNNING
SCAN_FOUND. . . . . .  C ADDR   0566H   R   SEG=RUNNING
SCAN_HAS_REQ. . . . .  C ADDR   050DH   R   SEG=RUNNING
SCAN_TRY_DOWN . . . .  C ADDR   0543H   R   SEG=RUNNING
SCAN_TRY_UP . . . . .  C ADDR   0522H   R   SEG=RUNNING
SCAN_UP_CHK . . . . .  C ADDR   0531H   R   SEG=RUNNING
SCAN_UP_LOOP. . . . .  C ADDR   0528H   R   SEG=RUNNING
SCAN_UP_NEXT. . . . .  C ADDR   0536H   R   SEG=RUNNING
SCDR_FOUND. . . . . .  C ADDR   05CCH   R   SEG=RUNNING
SCDR_HI . . . . . . .  C ADDR   05B6H   R   SEG=RUNNING
SCDR_NOTFOUND . . . .  C ADDR   05C8H   R   SEG=RUNNING
SCUR_FOUND. . . . . .  C ADDR   0598H   R   SEG=RUNNING
SCUR_HI . . . . . . .  C ADDR   0582H   R   SEG=RUNNING
SCUR_NOTFOUND . . . .  C ADDR   0594H   R   SEG=RUNNING
SEDR_HI . . . . . . .  C ADDR   0454H   R   SEG=RUNNING
SEG_TABLE . . . . . .  C ADDR   0000H   R   SEG=RUNNING
SET_EXT_DN_REQUEST. .  C ADDR   0442H   R   SEG=RUNNING
SET_EXT_UP_REQUEST. .  C ADDR   0422H   R   SEG=RUNNING
SET_INT_REQUEST . . .  C ADDR   0402H   R   SEG=RUNNING
SEUR_HI . . . . . . .  C ADDR   0434H   R   SEG=RUNNING
SHOW_OPEN_FLOOR . . .  C ADDR   02C5H   R   SEG=RUNNING
SHOW_OUTSIDE_STATUS .  C ADDR   033CH   R   SEG=RUNNING
SIR_HI. . . . . . . .  C ADDR   0414H   R   SEG=RUNNING
SOF_NEG . . . . . . .  C ADDR   02FBH   R   SEG=RUNNING
SOS_NONE. . . . . . .  C ADDR   0363H   R   SEG=RUNNING
SOS_UP. . . . . . . .  C ADDR   035CH   R   SEG=RUNNING
UCD_NEG . . . . . . .  C ADDR   05DCH   R   SEG=RUNNING
UPDATE_CUR_DISPLAY. .  C ADDR   05D0H   R   SEG=RUNNING
UPDATE_TGT_DISPLAY. .  C ADDR   05E6H   R   SEG=RUNNING
UTD_NEG . . . . . . .  C ADDR   05F2H   R   SEG=RUNNING


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
