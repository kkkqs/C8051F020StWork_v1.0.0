PUBLIC	MatrixKey

MK	SEGMENT	CODE
rseg	MK

MatrixKey:
		MOV A,#0FFh    ; 默认返回 0xFF 表示无键按下
		MOV P1,#0FFh

		CLR P1.3
		JB P1.7,MK_SK1
		AJMP MXK_1_CHECK
MK_SK1:
		JB P1.6,MK_SK2
		AJMP MXK_5_CHECK
MK_SK2:
		JB P1.5,MK_SK3
		AJMP MXK_9_CHECK
MK_SK3:
		JB P1.4,MK_SK4
		AJMP MXK_13_CHECK
MK_SK4:
		MOV P1,#0FFh

		CLR P1.2
		JB P1.7,MK_SK5
		AJMP MXK_2_CHECK
MK_SK5:
		JB P1.6,MK_SK6
		AJMP MXK_6_CHECK
MK_SK6:
		JB P1.5,MK_SK7
		AJMP MXK_10_CHECK
MK_SK7:
		JB P1.4,MK_SK8
		AJMP MXK_14_CHECK
MK_SK8:
		MOV P1,#0FFh

		CLR P1.1
		JB P1.7,MK_SK9
		AJMP MXK_3_CHECK
MK_SK9:
		JB P1.6,MK_SK10
		AJMP MXK_7_CHECK
MK_SK10:
		JB P1.5,MK_SK11
		AJMP MXK_11_CHECK
MK_SK11:
		JB P1.4,MK_SK12
		AJMP MXK_15_CHECK
MK_SK12:
		MOV P1,#0FFh

		CLR P1.0
		JB P1.7,MK_SK13
		AJMP MXK_4_CHECK
MK_SK13:
		JB P1.6,MK_SK14
		AJMP MXK_8_CHECK
MK_SK14:
		JB P1.5,MK_SK15
		AJMP MXK_12_CHECK
MK_SK15:
		JB P1.4,MK_SK16
		AJMP MXK_16_CHECK
MK_SK16:
		MOV P1,#0FFh
		RET

MXK_1_CHECK:
		MOV A,#0Fh
		MOV 040h,#01
		MOV 041h,#01
		RET
MXK_5_CHECK:
		MOV A,#0Eh
		MOV 040h,#01
		MOV 041h,#02
		RET
MXK_9_CHECK:
		MOV A,#0Dh
		MOV 040h,#01
		MOV 041h,#03
		RET
MXK_13_CHECK:
		MOV A,#0Ch
		MOV 040h,#01
		MOV 041h,#04
		RET
MXK_2_CHECK:
		MOV A,#0Bh
		MOV 040h,#02
		MOV 041h,#01
		RET
MXK_6_CHECK:
		MOV A,#0Ah
		MOV 040h,#02
		MOV 041h,#02
		RET
MXK_10_CHECK:
		MOV A,#09
		MOV 040h,#02
		MOV 041h,#03
		RET
MXK_14_CHECK:
		MOV A,#08
		MOV 040h,#02
		MOV 041h,#04
		RET
MXK_3_CHECK:
		MOV A,#07
		MOV 040h,#03
		MOV 041h,#01
		RET
MXK_7_CHECK:
		MOV A,#06
		MOV 040h,#03
		MOV 041h,#02
		RET
MXK_11_CHECK:
		MOV A,#05
		MOV 040h,#03
		MOV 041h,#03
		RET
MXK_15_CHECK:
		MOV A,#04
		MOV 040h,#03
		MOV 041h,#04
		RET
MXK_4_CHECK:
		MOV A,#03
		MOV 040h,#04
		MOV 041h,#01
		RET
MXK_8_CHECK:
		MOV A,#02
		MOV 040h,#04
		MOV 041h,#02
		RET
MXK_12_CHECK:
		MOV A,#01
		MOV 040h,#04
		MOV 041h,#03
		RET
MXK_16_CHECK:
		MOV A,#00
		MOV 040h,#04
		MOV 041h,#04
		RET

END
